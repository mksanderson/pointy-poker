#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

console.log('üîÑ Setting up production environment...');

const envProdPath = path.join(__dirname, '..', 'src', 'environments', 'environment.prod.ts');

// Read environment variables
const supabaseUrl = process.env.SUPABASE_URL;
const supabaseKey = process.env.SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseKey) {
    console.log('‚ùå Error: SUPABASE_URL and SUPABASE_ANON_KEY environment variables must be set');
    process.exit(1);
}

console.log('üìù Injecting environment variables into production config...');
console.log(`   SUPABASE_URL: ${supabaseUrl}`);
console.log(`   SUPABASE_ANON_KEY: ${supabaseKey.substring(0, 20)}...`);

const envContent = `// src/environments/environment.prod.ts (Generated by Netlify build)
export const environment = {
  production: true,
  supabaseUrl: '${supabaseUrl}',
  supabaseKey: '${supabaseKey}'
};
`;

try {
    fs.writeFileSync(envProdPath, envContent, 'utf8');
    console.log('‚úÖ Environment variables injected successfully');

    // Verify the file was written correctly
    const writtenContent = fs.readFileSync(envProdPath, 'utf8');
    console.log('üìã Verifying generated file:');
    console.log(writtenContent);
} catch (error) {
    console.error('‚ùå Failed to write environment file:', error);
    process.exit(1);
}
